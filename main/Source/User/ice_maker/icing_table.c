#include "icing_table.h"


#define MAX_INDEX_COLD_TEMP   46
#define MAX_INDEX_AMBI_TEMP   46

#define COMP_RPS_A  (50)    // over 30'c
#define COMP_RPS_B  (52)    // over 22'c
#define COMP_RPS_C  (60)    // over 13'c
#define COMP_RPS_D  (60)    // under 13'c

//""SUBR COMMENT""************************************************************
// ID         : Ice Make Time
// 개요	      : 
//----------------------------------------------------------------------------
// 기능       : 제빙 시간을 반환한다.  ( 단위 : 초 )
//				    실내 온도 및 외기 온도를 통해서 제빙 시간을 반환.
//				    시수 온도 0'C 영역은 미사용 영역으로 처리한다. 
//----------------------------------------------------------------------------
//""SUBR COMMENT END""********************************************************

/* [Cold Temp][Ambi Temp] */
static const U16 IcingTimeTable[MAX_INDEX_COLD_TEMP][MAX_INDEX_AMBI_TEMP] =
{
	/* Room Temp: 0 'C */
	{
	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0
	},

	/* Room Temp: 1 'C */
	{
	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	
		0,	0,	0,	0,	0,		0
	},

	/* Room Temp: 2 'C */
	{
	
		76,	106,	126,	145,	184,		208,	232,	256,	280,	304,	
		312,	354,	391,	423,	450,		472,	490,	505,	514,	519,	
		519,	511,	513,	516,	577,		578,	579,	581,	582,	586,	
		595,	606,	617,	631,	648,		668,	703,	738,	772,	805,	
		838,	871,	904,	937,	970,		1003
	},

	/* Room Temp: 3 'C */
	{
	
		88,	106,	126,	145,	190,		214,	238,	262,	286,	310,	
		318,	360,	397,	429,	456,		478,	496,	511,	520,	525,	
		524,	515,	517,	520,	581,		582,	583,	585,	586,	590,	
		599,	610,	621,	635,	652,		672,	707,	742,	777,	811,	
		844,	877,	910,	943,	976,		1009
	},

	/* Room Temp: 4 'C */
	{
	
		88,	118,	126,	145,	196,		220,	244,	268,	292,	316,	
		324,	366,	403,	435,	462,		484,	502,	517,	526,	530,	
		528,	519,	521,	524,	585,		586,	587,	589,	590,	594,	
		603,	614,	625,	639,	656,		676,	711,	746,	781,	816,	
		850,	883,	916,	949,	982,		1015
	},

	/* Room Temp: 5 'C */
	{
	
		88,	118,	126,	145,	196,		226,	250,	274,	298,	322,	
		330,	372,	409,	441,	468,		490,	508,	523,	531,	534,	
		532,	523,	525,	528,	589,		590,	591,	593,	594,	598,	
		607,	618,	629,	643,	660,		680,	715,	750,	785,	820,	
		855,	889,	922,	955,	988,		1021
	},

	/* Room Temp: 6 'C */
	{
	
		88,	118,	126,	145,	196,		226,	256,	280,	304,	328,	
		336,	378,	415,	447,	474,		496,	514,	528,	535,	538,	
		536,	527,	529,	532,	593,		594,	595,	597,	598,	602,	
		611,	622,	633,	647,	664,		684,	719,	754,	789,	824,	
		859,	894,	928,	961,	994,		1027
	},

	/* Room Temp: 7 'C */
	{
	
		88,	118,	126,	145,	208,		226,	256,	286,	310,	334,	
		342,	384,	421,	453,	480,		502,	519,	532,	539,	542,	
		540,	531,	533,	536,	597,		598,	599,	601,	602,	606,	
		615,	626,	637,	651,	668,		688,	723,	758,	793,	828,	
		863,	898,	933,	967,	1000,		1033
	},

	/* Room Temp: 8 'C */
	{
	
		100,	118,	126,	145,	208,		238,	256,	286,	316,	340,	
		348,	390,	427,	459,	486,		507,	523,	536,	544,	549,	
		549,	545,	546,	548,	608,		609,	609,	610,	610,	613,	
		621,	630,	641,	655,	672,		692,	727,	762,	797,	832,	
		867,	902,	937,	972,	1006,		1039
	},

	/* Room Temp: 9 'C */
	{
	
		100,	130,	126,	145,	208,		238,	268,	286,	316,	346,	
		354,	396,	433,	465,	492,		514,	531,	544,	554,	561,	
		565,	568,	568,	568,	627,		625,	624,	623,	622,	623,	
		630,	638,	649,	663,	680,		700,	735,	770,	805,	840,	
		875,	910,	945,	979,	1012,		1045
	},

	/* Room Temp: 10 'C */
	{
	
		100,	130,	126,	145,	208,		238,	268,	298,	316,	346,	
		360,	402,	439,	471,	498,		520,	538,	552,	562,	569,	
		573,	576,	576,	576,	635,		633,	632,	631,	630,	631,	
		638,	646,	657,	671,	688,		708,	743,	778,	813,	848,	
		883,	918,	952,	985,	1018,		1051
	},

	/* Room Temp: 11 'C */
	{
	
		100,	130,	126,	145,	208,		238,	268,	298,	316,	346,	
		360,	408,	445,	477,	504,		526,	544,	559,	571,	580,	
		588,	599,	599,	600,	659,		658,	657,	657,	656,	658,	
		665,	674,	684,	697,	713,		732,	766,	800,	834,	868,	
		891,	925,	958,	991,	1024,		1057
	},

	/* Room Temp: 12 'C */
	{
	
		100,	130,	126,	145,	220,		238,	268,	298,	316,	358,	
		360,	408,	451,	483,	510,		532,	550,	565,	578,	588,	
		596,	607,	609,	611,	672,		672,	673,	674,	675,	678,	
		687,	697,	704,	714,	726,		742,	773,	803,	834,	864,	
		898,	931,	964,	997,	1030,		1063
	},

	/* Room Temp: 13 'C */
	{
	
		112,	130,	126,	145,	220,		250,	268,	298,	316,	358,	
		372,	408,	451,	489,	516,		538,	556,	571,	584,	595,	
		603,	613,	615,	617,	679,		679,	680,	682,	683,	686,	
		695,	705,	715,	728,	743,		762,	795,	829,	863,	896,	
		904,	937,	970,	1003,	1036,		1069
	},

	/* Room Temp: 14 'C */
	{
	
		112,	142,	126,	145,	220,		250,	280,	298,	316,	358,	
		372,	420,	451,	489,	522,		544,	562,	577,	590,	600,	
		609,	619,	622,	625,	688,		689,	691,	694,	696,	700,	
		711,	723,	731,	742,	757,		774,	807,	839,	870,	902,	
		910,	943,	976,	1009,	1042,		1075
	},

	/* Room Temp: 15 'C */
	{
	
		112,	142,	172,	145,	220,		250,	280,	310,	316,	358,	
		372,	420,	463,	489,	522,		550,	568,	583,	596,	606,	
		615,	624,	628,	631,	692,		693,	695,	697,	698,	702,	
		712,	721,	735,	752,	772,		795,	833,	870,	906,	943,	
		916,	949,	982,	1015,	1048,		1081
	},

	/* Room Temp: 16 'C */
	{
	
		112,	142,	172,	202,	220,		250,	280,	310,	316,	358,	
		372,	420,	463,	501,	522,		550,	574,	589,	602,	612,	
		620,	628,	634,	639,	701,		703,	706,	709,	711,	716,	
		727,	739,	754,	772,	792,		816,	854,	880,	917,	964,	
		922,	955,	988,	1021,	1054,		1087
	},

	/* Room Temp: 17 'C */
	{
	
		112,	142,	172,	202,	232,		250,	280,	310,	316,	370,	
		372,	420,	463,	501,	534,		550,	574,	595,	607,	617,	
		625,	632,	642,	652,	720,		726,	733,	740,	747,	756,	
		771,	787,	797,	809,	825,		842,	874,	906,	938,	970,	
		928,	961,	994,	1027,	1060,		1093
	},

	/* Room Temp: 18 'C */
	{
	
		112,	142,	172,	202,	232,		262,	280,	310,	316,	370,	
		384,	420,	463,	501,	534,		562,	574,	595,	613,	623,	
		630,	636,	646,	656,	726,		733,	740,	748,	755,	764,	
		779,	795,	805,	817,	832,		848,	880,	912,	944,	976,	
		934,	967,	1000,	1033,	1066,		1099
	},

	/* Room Temp: 19 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	310,	316,	370,	
		384,	432,	463,	501,	534,		562,	586,	595,	613,	628,	
		635,	640,	650,	660,	728,		736,	744,	750,	757,	766,	
		781,	796,	806,	819,	834,		851,	884,	917,	949,	982,	
		940,	973,	1006,	1039,	1072,		1105
	},

	/* Room Temp: 20 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	370,	
		384,	432,	475,	501,	534,		562,	586,	607,	613,	628,	
		640,	645,	654,	663,	731,		738,	747,	754,	760,	768,	
		782,	797,	808,	821,	837,		856,	890,	924,	958,	993,	
		946,	979,	1012,	1045,	1078,		1111
	},

	/* Room Temp: 21 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	370,	
		384,	432,	475,	513,	534,		562,	586,	607,	625,	628,	
		640,	651,	653,	662,	730,		737,	745,	754,	761,	769,	
		783,	797,	810,	826,	846,		868,	906,	943,	981,	1019,	
		952,	985,	1018,	1051,	1084,		1117
	},

	/* Room Temp: 22 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		384,	432,	475,	513,	546,		562,	586,	607,	625,	640,	
		640,	651,	659,	661,	729,		736,	744,	753,	761,	770,	
		783,	796,	815,	837,	863,		891,	934,	977,	1021,	1065,	
		958,	991,	1024,	1057,	1090,		1123
	},

	/* Room Temp: 23 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	432,	475,	513,	546,		574,	586,	607,	625,	640,	
		652,	651,	659,	667,	728,		735,	743,	751,	760,	770,	
		782,	795,	816,	840,	866,		896,	941,	986,	1031,	1076,	
		964,	997,	1030,	1063,	1096,		1129
	},

	/* Room Temp: 24 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	475,	513,	546,		574,	598,	607,	625,	640,	
		652,	663,	659,	667,	734,		734,	742,	750,	759,	769,	
		781,	794,	816,	841,	869,		900,	946,	992,	1038,	1087,	
		970,	1003,	1036,	1069,	1102,		1135
	},

	/* Room Temp: 25 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	513,	546,		574,	598,	619,	625,	640,	
		652,	663,	671,	667,	734,		740,	741,	749,	757,	768,	
		780,	793,	807,	824,	844,		867,	905,	943,	981,	1018,	
		976,	1009,	1042,	1075,	1108,		1141
	},

	/* Room Temp: 26 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	546,		574,	598,	619,	637,	640,	
		652,	663,	671,	679,	734,		740,	747,	748,	756,	767,	
		779,	792,	807,	825,	846,		871,	910,	949,	988,	1029,	
		982,	1015,	1048,	1081,	1114,		1147
	},

	/* Room Temp: 27 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		574,	598,	619,	637,	652,	
		652,	663,	671,	679,	746,		740,	747,	754,	755,	765,	
		778,	791,	809,	829,	853,		868,	910,	951,	993,	1035,	
		988,	1021,	1054,	1087,	1120,		1153
	},

	/* Room Temp: 28 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	598,	619,	637,	652,	
		664,	663,	671,	679,	746,		752,	747,	754,	761,	764,	
		777,	790,	809,	832,	857,		886,	929,	973,	1016,	1071,	
		994,	1027,	1060,	1093,	1126,		1159
	},

	/* Room Temp: 29 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	619,	637,	652,	
		664,	675,	671,	679,	746,		752,	759,	754,	761,	770,	
		775,	789,	815,	843,	875,		909,	959,	1008,	1058,	1107,	
		1000,	1033,	1066,	1099,	1132,		1165
	},

	/* Room Temp: 30 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	637,	652,	
		664,	675,	683,	679,	746,		752,	759,	766,	761,	770,	
		781,	787,	812,	840,	870,		904,	952,	1001,	1049,	1098,	
		1006,	1039,	1072,	1105,	1138,		1171
	},

	/* Room Temp: 31 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	652,	
		664,	675,	683,	691,	746,		752,	759,	766,	773,	770,	
		781,	793,	802,	830,	861,		894,	943,	991,	1041,	1089,	
		1012,	1045,	1078,	1111,	1144,		1177
	},

	/* Room Temp: 32 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		664,	675,	683,	691,	758,		752,	759,	766,	773,	782,	
		781,	793,	808,	820,	851,		885,	934,	983,	1032,	1080,	
		1018,	1051,	1084,	1117,	1150,		1183
	},

	/* Room Temp: 33 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	675,	683,	691,	758,		764,	759,	766,	773,	782,	
		793,	793,	808,	826,	841,		875,	924,	973,	1022,	1071,	
		1024,	1057,	1090,	1123,	1156,		1189
	},

	/* Room Temp: 34 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	683,	691,	758,		764,	771,	766,	773,	782,	
		793,	805,	808,	826,	847,		865,	914,	964,	1013,	1062,	
		1030,	1063,	1096,	1129,	1162,		1195
	},

	/* Room Temp: 35 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	691,	758,		764,	771,	778,	773,	782,	
		793,	805,	820,	826,	847,		871,	904,	953,	1003,	1053,	
		1036,	1069,	1102,	1135,	1168,		1201
	},

	/* Room Temp: 36 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	758,		764,	771,	778,	785,	782,	
		793,	805,	820,	838,	847,		871,	904,	937,	988,	1038,	
		1036,	1069,	1102,	1135,	1168,		1201
	},

	/* Room Temp: 37 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		764,	771,	778,	785,	794,	
		793,	805,	820,	838,	859,		871,	904,	937,	970,	1023,	
		1036,	1069,	1102,	1135,	1168,		1201
	},

	/* Room Temp: 38 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	771,	778,	785,	794,	
		805,	805,	820,	838,	859,		883,	916,	949,	982,	1015,	
		1048,	1081,	1114,	1147,	1180,		1213
	},

	/* Room Temp: 39 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	783,	778,	785,	794,	
		805,	817,	820,	838,	859,		883,	916,	949,	982,	1015,	
		1048,	1081,	1114,	1147,	1180,		1213
	},

	/* Room Temp: 40 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	783,	790,	785,	794,	
		805,	817,	832,	838,	859,		883,	916,	949,	982,	1015,	
		1048,	1081,	1114,	1147,	1180,		1213
	},

	/* Room Temp: 41 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	783,	790,	797,	794,	
		805,	817,	832,	850,	859,		883,	916,	949,	982,	1015,	
		1048,	1081,	1114,	1147,	1180,		1213
	},

	/* Room Temp: 42 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	783,	790,	797,	806,	
		805,	817,	832,	850,	871,		883,	916,	949,	982,	1015,	
		1048,	1081,	1114,	1147,	1180,		1213
	},

	/* Room Temp: 43 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	783,	790,	797,	806,	
		817,	817,	832,	850,	871,		895,	928,	961,	994,	1027,	
		1060,	1093,	1126,	1159,	1192,		1225
	},

	/* Room Temp: 44 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	783,	790,	797,	806,	
		817,	829,	832,	850,	871,		895,	928,	961,	994,	1027,	
		1060,	1093,	1126,	1159,	1192,		1225
	},

	/* Room Temp: 45 'C */
	{
	
		112,	142,	172,	202,	232,		262,	292,	322,	316,	382,	
		396,	444,	487,	525,	558,		586,	610,	631,	649,	664,	
		676,	687,	695,	703,	770,		776,	783,	790,	797,	806,	
		817,	829,	844,	850,	871,		895,	928,	961,	994,	1027,	
		1060,	1093,	1126,	1159,	1192,		1225
	},

};

U16 IsValidRangeTemp(TEMP_T tCold, TEMP_T tAmbi )
{
    if( tCold < 1.0f || tCold > 45.0f )
    {
        return FALSE;
    }

    if( tAmbi < 0.0f || tAmbi > 43.0f )
    {
        return FALSE;
    }

    return TRUE;
}

/* 정수 및 외기 온도 값은 반올림 한다.
 * 0'C 보다 낮으면 0'C로 취급한다.
 *
 * 정수 온도 및 외기 온도에 따라, 제빙 시간을 반환한다. ( 단위 : 100ms )
 */
U16 GetIcingTime(TEMP_T tCold, TEMP_T tAmbi )
{
    U16 mu16IdxCold;
    U16 mu16IdxAmbi;
    U16 mu16IcingTime = 0;

    /* ROUND UP */
    tCold = tCold + 0.5f;
    if( tCold < 1.0f )
    {
        tCold = 1.0f;
    }

    tAmbi = tAmbi + 0.5f;
    if( tAmbi < 1.0f )
    {
        tAmbi = 0.0f;
    }

    mu16IdxCold = (U16)tCold;
    if( mu16IdxCold >= MAX_INDEX_COLD_TEMP )
    {
        mu16IdxCold = MAX_INDEX_COLD_TEMP - 1 ;
    }

    mu16IdxAmbi = (U16)tAmbi;
    if( mu16IdxAmbi >= MAX_INDEX_AMBI_TEMP )
    {
        mu16IdxAmbi = MAX_INDEX_AMBI_TEMP - 1 ;
    }

    mu16IcingTime = IcingTimeTable[ mu16IdxCold ][ mu16IdxAmbi ] * 10U;
    return mu16IcingTime;
}

U8 GetIcingCompRps( TEMP_T tAmbi )
{
    U8 mu8Rps = COMP_RPS_A;

    if( tAmbi >= 30.0f )  // over 30'c
    {
        mu8Rps = COMP_RPS_A;
    }
    else if( tAmbi >= 22.0f )   // over 22'c
    {
        mu8Rps = COMP_RPS_B;
    }
    else if( tAmbi >= 13.0f )   // over 13'c
    {
        mu8Rps = COMP_RPS_C;
    }
    else                        // under 13'c
    {
        mu8Rps = COMP_RPS_D;
    }  
    
    return mu8Rps;   
}

U8 GetIcingFanOnOff(TEMP_T tAmbi)
{
    U8 fanOnOff = OFF;

    if( tAmbi >= 30.0f )  // over 30'c
    {
        fanOnOff = ON;
    }
    else if( tAmbi >= 22.0f )   // over 22'c
    {
        fanOnOff = ON;
    }
    else if( tAmbi >= 13.0f )   // over 13'c
    {
        fanOnOff = OFF;
    }
    else                        // under 13'c
    {
        fanOnOff = OFF;
    } 

    return fanOnOff;
}
